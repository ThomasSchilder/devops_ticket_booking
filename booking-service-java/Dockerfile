# Use an official OpenJDK runtime as a parent image
FROM openjdk:17-jdk-slim

# Set the working directory in the container

# Install Maven
RUN apt-get update && \
    apt-get install -y maven && \
    rm -rf /var/lib/apt/lists/*

# Verify Maven installation
RUN mvn --version

# Arguments that can be passed during the build process
ARG ZEEBE_CLIENT_CLOUD_REGION
ARG ZEEBE_CLIENT_CLOUD_CLUSTERID
ARG ZEEBE_CLIENT_CLOUD_CLIENTID
ARG ZEEBE_CLIENT_CLOUD_CLIENTSECRET
ARG SPRING_RABBITMG_ADRESSES
ARG SPRING_RABBITMG_HOST
ARG SPRING_RABBITMG_USERNAME
ARG SPRING_RABBITMG_PORT
ARG SPRING_RABBITMG_PASSWORD
ARG SPRING_RABBITMG_VIRTUAL_HOST
ARG SPRING_RABBITMG_SSL_ENABLED

# Set the environment variables inside the container
ENV ZEEBE_CLIENT_CLOUD_REGION=$ZEEBE_CLIENT_CLOUD_REGION \
    ZEEBE_CLIENT_CLOUD_CLUSTERID=$ZEEBE_CLIENT_CLOUD_CLUSTERID \
    ZEEBE_CLIENT_CLOUD_CLIENTID=$ZEEBE_CLIENT_CLOUD_CLIENTID \
    ZEEBE_CLIENT_CLOUD_CLIENTSECRET=$ZEEBE_CLIENT_CLOUD_CLIENTSECRET \
    SPRING_RABBITMG_ADRESSES=$SPRING_RABBITMG_ADRESSES \
    SPRING_RABBITMG_HOST=$SPRING_RABBITMG_HOST \
    SPRING_RABBITMG_USERNAME=$SPRING_RABBITMG_USERNAME \
    SPRING_RABBITMG_PORT=$SPRING_RABBITMG_PORT \
    SPRING_RABBITMG_PASSWORD=$SPRING_RABBITMG_PASSWORD \
    SPRING_RABBITMG_VIRTUAL_HOST=$SPRING_RABBITMG_VIRTUAL_HOST \
    SPRING_RABBITMG_SSL_ENABLED=$SPRING_RABBITMG_SSL_ENABLED \
    DATABASE_PASSWORD=$DATABASE_PASSWORD

# Copy the current directory contents into the container at /app
COPY ./booking-service-java ./app

WORKDIR ./app
# Define default command to run when the container starts
CMD ["mvn", "package", "exec:java"]

